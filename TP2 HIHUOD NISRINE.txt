                  TP2
**************QUESTION 1********************

SET SERVEROUTPUT ON;

DECLARE

CURSOR c_moncursor is
SELECT * FROM EMPLOYEES ;
n integer:=0;
r_direction EMPLOYEES%rowtype;

BEGIN
             
 FOR n IN c_moncursor LOOP
 DBMS_OUTPUT.PUT_LINE('Employé ' || n.first_name || ' '  || n.last_name || '(ID :' || n.employee_id || ')' || 
 'travaille comme ' || n.job_title || 'depuis ' || n.hire_date);
    if n.manager_id is not null then
    SELECT * INTO r_direction FROM EMPLOYEES WHERE employee_id = n.manager_id;
    DBMS_OUTPUT.PUT_LINE('sous la direction de ' || r_direction.last_name || ' ( matricule : '|| r_direction.employee_id || ' )' );
    end if;
 DBMS_OUTPUT.PUT_LINE('  ');
 END LOOP;

END;

**************QUESTION 2********************

SET SERVEROUTPUT ON;

DECLARE

CURSOR c_customer (v_customer_id orders.customer_id%type ) IS
SELECT * FROM orders WHERE customer_id=v_customer_id;

CURSOR c_employee (v_salesman_id orders.salesman_id%type ) IS
SELECT * FROM orders WHERE salesman_id=v_salesman_id;

c_idcherch orders.customer_id%type;
i integer;
c integer:=0;

BEGIN
c_idcherch:=&c_idcherch;

FOR i IN c_customer(c_idcherch) LOOP
c := c + 1;
END LOOP;

DBMS_OUTPUT.PUT_LINE('Le client ' || c_idcherch || ' a ' || c || ' commandes');

c_idcherch:=&c_idcherch;
c :=0;
FOR i IN c_employee(c_idcherch) LOOP
c := c + 1;
END LOOP;

DBMS_OUTPUT.PUT_LINE('L Employee ' || c_idcherch || ' a ' || c || ' ventes');


END;


**************QUESTION 3********************

SET SERVEROUTPUT ON;    

DECLARE
CURSOR c_customer IS
SELECT customer_id , SUM(QUANTITY*UNIT_PRICE)
FROM orders
INNER JOIN order_items USING( order_id )
group by customer_id
having SUM(QUANTITY*UNIT_PRICE) > 2000;
    
c integer;
n integer;
    
BEGIN 

c:=0;
 for n IN c_customer LOOP
   UPDATE customers SET credit_limit=credit_limit+50
   WHERE customer_id=n.customer_id;
   c:=c+1;
 END LOOP;

DBMS_OUTPUT.PUT_LINE('Le nombre de lignes  est :' || c);

END;

**************QUESTION 4 ********************

SET SERVEROUTPUT ON;    

DECLARE
CURSOR c_customer IS
SELECT customer_id , SUM(QUANTITY*UNIT_PRICE)
FROM orders
INNER JOIN order_items USING( order_id )
group by customer_id
having SUM(QUANTITY*UNIT_PRICE) > 10000;
    
c integer;
n integer;
    
BEGIN 

c:=0;
 for n IN c_customer LOOP
   UPDATE customers SET credit_limit=credit_limit+50
   WHERE customer_id=n.customer_id;
   c:=c+1;
 END LOOP;

DBMS_OUTPUT.PUT_LINE('Le nombre de lignes  est :' || c);

END;

